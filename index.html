<script>
  const SUPABASE_URL = "https://ifoluumtfnkhszhnhveu.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_Q6bzxDdjaaQGsF_JDkSJCA_6IDUyuzT";

  // ✅ IMPORTANT: different variable name
  const supabaseClient = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  async function verifyEmail() {
    try {
      const params = new URLSearchParams(window.location.search);
      const token_hash = params.get("token_hash");
      const type = params.get("type"); // signup | magiclink | recovery

      if (!token_hash || !type) {
        throw new Error("Invalid or expired verification link.");
      }

      const { error } = await supabaseClient.auth.verifyOtp({
        type,
        token_hash,
      });

      if (error) throw error;

      document.getElementById("icon").textContent = "✅";
      document.getElementById("icon").className = "icon success";
      document.getElementById("title").textContent = "Email Verified";
      document.getElementById("message").textContent =
        "Your email has been verified. You may now return to the SafeCall app.";

    } catch (err) {
      document.getElementById("icon").textContent = "❌";
      document.getElementById("icon").className = "icon error";
      document.getElementById("title").textContent = "Verification Failed";
      document.getElementById("message").textContent =
        err.message ?? "Verification failed.";
      console.error(err);
    }
  }

  verifyEmail();
</script>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SafeCall Verify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<h2 id="status">‚è≥ Loading verification‚Ä¶</h2>

<script>
  try {
    document.getElementById("status").innerText = "üì¶ Supabase loaded";

    const supabaseUrl = "https://ifoluumtfnkhszhnhveu.supabase.co";
    const supabaseKey = "sb_publishable_Q6bzxDdjaaQGsF_JDkSJCA_6IDUyuzT";

    const supabase = window.supabase.createClient(
      supabaseUrl,
      supabaseKey
    );

    document.getElementById("status").innerText = "üîç Reading verification code‚Ä¶";

    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");

    if (!code) {
      document.getElementById("status").innerText =
        "‚ùå No verification code found in URL";
      throw new Error("Missing code");
    }

    document.getElementById("status").innerText =
      "üîê Verifying email with Supabase‚Ä¶";

    supabase.auth.exchangeCodeForSession(code)
      .then(({ error }) => {
        if (error) {
          document.getElementById("status").innerText =
            "‚ùå Verification failed: " + error.message;
        } else {
          document.getElementById("status").innerText =
            "‚úÖ Email verified! You may return to the app.";
        }
      });

  } catch (e) {
    document.getElementById("status").innerText =
      "‚ùå JavaScript error: " + e.message;
    console.error(e);
  }
</script>

</body>
</html>

